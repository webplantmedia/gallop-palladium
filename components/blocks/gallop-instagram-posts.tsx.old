import { parse } from '@wordpress/block-serialization-default-parser';
import {
  hasInnerBlocks,
  getAttr,
  cleanHTML,
  hasClass,
  cleanLink,
  formatAMPM,
  grabMatch,
} from '../../lib/utils/tools';
import { ArrowSmallRightIcon } from '@heroicons/react/20/solid';
import classNames from 'classnames';

export const GallopInstagramPosts = ({ block, parent = null }) => {
  // console.log(block);
  const posts = getAttr('posts', block);
  let html = cleanHTML(block.innerHTML);
  // const posts = block?.attrs?.posts;
  // console.log(posts);

  return (
    <div
      className={classNames(
        {
          ['alignwide']: hasClass('alignwide', html),
          ['alignfull']: hasClass('alignfull', html),
        },
        'grid grid-cols-1 md:grid-cols-2 3xl:grid-cols-3 gap-8 mb-14'
      )}
    >
      {posts.map((post: any, index: number) => {
        const p = post?.node;
        const d = new Date(p?.date);
        const date = formatAMPM(d);
        // console.log(p);
        let content = grabMatch(/<p[^>]*>(.*?)<\/p>/g, p?.excerpt);
        return (
          <section key={index} className="">
            <div className="bg-white/10 shadow-lg rounded-sm p-0">
              <a className="block" href={p?.link}>
                <img
                  alt={p?.featuredImage?.node?.altText}
                  title={p?.featuredImage?.node?.title}
                  className="mb-0 rounded-sm"
                  src={p?.featuredImage?.node?.mediaItemUrl}
                />
              </a>
              <div className="p-6 sm:p-8">
                <h3 className="mb-0 leading-tight text-2xl text-primary-main small-caps break-all">
                  {p?.title}
                </h3>
                <span className="font-bold mb-4 text-sm block text-base-contrast">
                  {date}
                </span>
                <p className="mb-8 leading-normal text-base line-clamp-5 text-ellipsis">
                  <span dangerouslySetInnerHTML={{ __html: content }} />{' '}
                </p>

                <a
                  href={p?.link}
                  className="bg-secondary-main text-secondary-contrast hover:bg-secondary-light text-sm py-1.5 px-2.5 w-full text-center rounded-md shadow-sm flex items-center justify-center mt-auto"
                >
                  Continue Reading
                  <ArrowSmallRightIcon
                    className="ml-1 -mr-1 h-5 w-5 text-primary-contrast"
                    aria-hidden="true"
                  />
                </a>
              </div>
            </div>
          </section>
        );
      })}
    </div>
  );
};
